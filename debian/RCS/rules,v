head	1.6;
access;
symbols;
locks; strict;
comment	@# @;


1.6
date	2001.07.21.11.59.46;	author matt;	state Exp;
branches;
next	1.5;

1.5
date	2001.07.06.17.01.30;	author matt;	state Exp;
branches;
next	1.4;

1.4
date	2001.03.19.13.25.30;	author matt;	state Exp;
branches;
next	1.3;

1.3
date	2000.08.29.10.30.55;	author matt;	state Exp;
branches;
next	1.2;

1.2
date	2000.08.29.10.28.59;	author matt;	state Exp;
branches;
next	1.1;

1.1
date	2000.05.05.17.05.08;	author matt;	state Exp;
branches;
next	;


desc
@Initial revision.
@


1.6
log
@Added more man pages and extra links for binaries.
@
text
@#!/usr/bin/make -f
#
# Rules for making sSMTP - Matt Ryan
#
SHELL=/bin/bash
CC = gcc

do_cfg:
	test -f Makefile || ./configure --prefix="/usr"

build:	do_cfg
	make

binary:	binary-arch binary-indep

binary-arch:	checkroot configure build
	-rm -rf debian/tmp

	dpkg-shlibdeps ssmtp

	install -d -m 755 -o root -g root debian/tmp/DEBIAN
	dpkg-gencontrol
	install -m 400 debian/conffiles debian/tmp/DEBIAN
	install -m 555 debian/preinst debian/tmp/DEBIAN
	install -m 555 debian/postinst debian/tmp/DEBIAN
	install -m 555 debian/postrm debian/tmp/DEBIAN
	install -m 555 debian/config debian/tmp/DEBIAN
	install -m 555 debian/templates debian/tmp/DEBIAN

	install -d -m 755 debian/tmp/usr/sbin
	install -s -m 755 ssmtp debian/tmp/usr/sbin/ssmtp
	install -d -m 755 debian/tmp/usr/share/man/man8
	install -m 644 ssmtp.8 debian/tmp/usr/share/man/man8/ssmtp.8
	install -d -m 755 debian/tmp/etc/ssmtp
	install -m 644 revaliases debian/tmp/etc/ssmtp/revaliases

	-cd debian/tmp/usr/sbin && ln -sf ssmtp sendmail
	install -d -m 755 -o root -g root debian/tmp/usr/lib
	-cd debian/tmp/usr/lib && ln -sf ../sbin/sendmail .

	-cd debian/tmp/usr/sbin && ln -sf ssmtp newaliases
	install -m 644 debian/newaliases.8 debian/tmp/usr/share/man/man8
	-cd debian/tmp/usr/sbin && ln -sf ssmtp mailq
	install -m 644 debian/mailq.8 debian/tmp/usr/share/man/man8

	gzip -9v debian/tmp/usr/share/man/man8/*
	-cd debian/tmp/usr/share/man/man8 && ln -sf ssmtp.8.gz sendmail.8.gz

	install -d -m 755 -o root -g root debian/tmp/usr/share/doc/ssmtp
	install -m 644 README debian/tmp/usr/share/doc/ssmtp
	install -m 644 debian/README.debian debian/tmp/usr/share/doc/ssmtp/README.Debian
	install -m 644 debian/copyright debian/tmp/usr/share/doc/ssmtp
	install -m 644 debian/changelog debian/tmp/usr/share/doc/ssmtp/changelog
	install -m 644 OLD/CHANGELOG debian/tmp/usr/share/doc/ssmtp/CHANGELOG_OLD
	gzip -9 debian/tmp/usr/share/doc/ssmtp/{changelog,CHANGELOG_OLD}

	dpkg --build debian/tmp ..

binary-indep:

clean:	do_cfg
	-rm -rf debian/tmp
	-rm -f debian/{files,substvars}
	test -f Makefile && make distclean

checkroot:
	test root = "`whoami`"


.PHONY: build binary clean checkroot
@


1.5
log
@Updated for new build setup.
@
text
@d30 3
a32 3
	install -d -m 755 debian/tmp//usr/sbin
	install -s -m 755 ssmtp debian/tmp//usr/sbin/ssmtp
	install -d -m 755 debian/tmp//usr/share/man/man8
d41 1
d43 3
d53 3
a55 3
	install -m 644 debian/changelog debian/tmp/usr/share/doc/ssmtp/changelog.Debian
	install -m 644 OLD/CHANGELOG debian/tmp/usr/share/doc/ssmtp/changelog
	gzip -9 debian/tmp/usr/share/doc/ssmtp/changelog*
@


1.4
log
@Removed /etc/ssmtp/ssmtp.conf from package.
@
text
@d8 4
a11 1
build:
d16 1
a16 1
binary-arch:	checkroot build
d30 6
a35 1
	-env ROOT=debian/tmp make install
d50 1
a50 1
	install -m 644 CHANGELOG debian/tmp/usr/share/doc/ssmtp/changelog
a52 1
	-rm -f debian/tmp/etc/ssmtp/ssmtp.conf
d57 1
a57 1
clean:
d60 1
a60 1
	test -f Makefile && make clean
d63 1
a63 1
#	test root = "`whoami`"
@


1.3
log
@Compresses manpages (Fixes #67606).
@
text
@a27 1
	cp /dev/null debian/tmp/etc/ssmtp/ssmtp.conf
d45 1
@


1.2
log
@Checkpoint.
@
text
@a32 1
	-cd debian/tmp/usr/share/man/man8 && ln -sf ssmtp.8 sendmail.8
d35 2
@


1.1
log
@Initial revision
@
text
@d2 42
a43 3
# Based on the sample debian/rules that uses debhelper.
# GNU copyright 1997 to 1999 by Joey Hess.
# GNU copyright 1999 by Hugo Haas.
d45 1
a45 2
# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1
d47 1
a47 2
# This is the debhelper compatability version to use.
export DH_COMPAT=1
d49 4
a52 5
build: build-stamp
build-stamp:
	dh_testdir

	$(MAKE) FLAGS="-O2 -g -Wall"
d54 2
a55 1
	touch build-stamp
a56 53
clean:
	dh_testdir
	dh_testroot
	rm -f build-stamp

	-$(MAKE) clean

	dh_clean

install: build
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_installdirs

	$(MAKE) ROOT=`pwd`/debian/tmp LOCATION=/usr install-sendmail
	rm debian/tmp/etc/ssmtp/ssmtp.conf
	touch debian/tmp/etc/ssmtp/ssmtp.conf

# Build architecture-independent files here.
binary-indep: build install
# We have nothing to do by default.

# Build architecture-dependent files here.
binary-arch: build install
#	dh_testversion
	dh_testdir
	dh_testroot
#	dh_installdebconf	
	dh_installdocs
#	dh_installexamples
#	dh_installmenu
#	dh_installemacsen
#	dh_installpam
#	dh_installinit
#	dh_installcron
	dh_installmanpages
#	dh_installinfo
#	dh_undocumented
	dh_installchangelogs CHANGELOG
	dh_link
	dh_strip
	dh_compress
	dh_fixperms
	# You may want to make some executables suid here.
#	dh_suidregister
#	dh_makeshlibs
	dh_installdeb
#	dh_perl
	dh_shlibdeps
	dh_gencontrol
	dh_md5sums
	dh_builddeb
d58 1
a58 2
binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary install
@
